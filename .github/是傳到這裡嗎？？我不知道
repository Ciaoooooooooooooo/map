#include <iostream>
#include <thread>
#include <chrono>
#include <map>
#include <windows.h>

using namespace std;

const map<int, string> colors = {
    {0, "\033[0m"},     // reset
	{1, "\033[33m"},    // yellow
    {2, "\033[36m"},    // blue
	{3, "\033[37m"},    // white
	{4, "\033[31m"},    // red
};



void slowPrint(const string& text,int color) {
	 int charDelay=30;
	 int lineDelay=1000;// 每個字 50ms，每行 1000ms
	cout << colors.at(color);
    for (char c : text) {
        cout << c << flush;
        this_thread::sleep_for(chrono::milliseconds(charDelay)); // 逐字延遲
    }
    cout << endl;
    this_thread::sleep_for(chrono::milliseconds(lineDelay)); // 換行後的停頓
    cout << colors.at(0);
}

void opening(){
	slowPrint("「頭好暈……怎麼回事？」",1);  
    slowPrint("你從昏迷中醒來，茫然地抬起頭。四周昏暗，空氣裡瀰漫著陳舊紙張的味道。",3);
    cout<<endl; 
    slowPrint("「這裡是……學校的圖書館？」",1); 
    slowPrint("四下打量後，你又覺得哪裡不太對勁——某些地方，與記憶中的畫面有些偏差。",3); 
    cout<<endl;
    slowPrint("「……不管怎樣，還是先想辦法離開這裡吧。」",1); 
}

void library_map(){
	cout<<endl; 
	slowPrint("------------------------------------------------------------",3); 
	slowPrint("巧穎再麻煩你把地圖的程式碼放進這個library_map函式裡，感謝！！！！",3); 
	slowPrint("終點觸發的文字寫到「……開始讀起書中的內容。」就可以了",3);
	slowPrint("然後如果要輸出有延遲效果的文字複製「slowPrint( ,3);」這一行就好",3);
	slowPrint("------------------------------------------------------------",3); 
}


int psychologicaltest(){
	char option=0;
	
	cout<<endl; 
	slowPrint("「第一題！對於戀愛小說，你喜歡哪種類型？」",2); 
	cout<<"a.當然是要甜甜的校園戀愛啊！"<<endl;
	cout<<"b.破鏡難圓的劇情非常好吃……"<<endl;
	cout<<"c.談什麼戀愛！自己一個人最棒了！"<<endl;
	while(cin>>option){
		
		if(option=='a'){
			slowPrint("「第二題！你覺得人生是由什麼組成的呢？」",2); 
			cout<<"a.未知的意外。"<<endl;
			cout<<"b.過去的因果。"<<endl;
			cout<<"c.相同的事件。"<<endl;
			cout<<"d.無法掌控的命運。"<<endl;
			
			while(cin>>option){
				if(option=='a'){return 1;}
				else if(option=='b'){return 2;}
				else if(option=='c'){return 3;}
				else if(option=='d'){return 4;}
				else{slowPrint("請輸入正確選項！！",4); }
			}
		}
		
		else if(option=='b'){
			slowPrint("「第二題！如果被丟到無人島上該怎麼辦呢？」",2); 
			cout<<"a.確保衛生！"<<endl;
			cout<<"b.尋找食物！"<<endl;
			
			while(cin>>option){
				if(option=='a'){return 5;}
				else if(option=='b'){return 6;}
				else{slowPrint("請輸入正確選項！！",4); }
			}
		}
		
		else if(option=='c'){
			slowPrint("「第二題！既然是自己一個人的話，那你喜歡什麼樣的生活呢？」",2); 
			cout<<"a.刺激有趣的冒險！"<<endl;
			cout<<"b.開心快樂的玩耍！"<<endl;
			cout<<"c.平靜安穩的日常。"<<endl;
			
			while(cin>>option){
				if(option=='a'){return 7;}
				else if(option=='b'){return 8;}
				else if(option=='c'){return 9;}
				else{slowPrint("請輸入正確選項！！",4); }
			}
		}
		
		else{slowPrint("請輸入正確選項！！",4); }
		
	}
	
}

int test_text(){
	int character=0;
	char user_continue;
	do{
   		character=psychologicaltest();
    	slowPrint("「嗯嗯嗯……我已經知道最適合你的起司啦！你決定好這就是你的起司了嗎？還是要再來一遍？」",2); 
    	cout<<"a.決定好啦！"<<endl;
		cout<<"b.還要再想想……"<<endl;
    	while(cin>>user_continue){
				if(user_continue=='a'){
					slowPrint("「好耶！那我們來揭曉答案吧！」",2); 
					break;
				}
				if(user_continue=='b'){
					slowPrint("「好，那我們再試一次吧！」",2); 
					break;
				}
				else{slowPrint("請輸入正確選項！！",4); }
		}
	}while(user_continue=='b');
	
	return character;
}



void character_Bech(){
	cout<<endl;
	slowPrint("我中間劇情還沒寫完(尖叫)",2); 
	slowPrint("等全部寫完我再一起放上來好了(陰暗地爬走)",2);  
}

void character_Feichanyin(){
	cout<<endl;
	slowPrint("我中間劇情還沒寫完(尖叫)",2); 
	slowPrint("等全部寫完我再一起放上來好了(陰暗地爬走)",2);  
}
void character_Roselyne(){
	cout<<endl;
	slowPrint("我中間劇情還沒寫完(尖叫)",2); 
	slowPrint("等全部寫完我再一起放上來好了(陰暗地爬走)",2);   
}
void character_Iris(){
	cout<<endl;
	slowPrint("我中間劇情還沒寫完(尖叫)",2); 
	slowPrint("等全部寫完我再一起放上來好了(陰暗地爬走)",2);  
}
void character_Taro(){
	cout<<endl;
	slowPrint("我中間劇情還沒寫完(尖叫)",2); 
	slowPrint("等全部寫完我再一起放上來好了(陰暗地爬走)",2);  
}
void character_Siegfried(){
	cout<<endl;
	slowPrint("我中間劇情還沒寫完(尖叫)",2); 
	slowPrint("等全部寫完我再一起放上來好了(陰暗地爬走)",2);  
}
void character_Mina(){
	cout<<endl;
	slowPrint("我中間劇情還沒寫完(尖叫)",2); 
	slowPrint("等全部寫完我再一起放上來好了(陰暗地爬走)",2);  
}
void character_Suoxiaohua(){
	cout<<endl;
	slowPrint("我中間劇情還沒寫完(尖叫)",2); 
	slowPrint("等全部寫完我再一起放上來好了(陰暗地爬走)",2); 
}
void character_Liuyiyi(){
	cout<<endl;
	slowPrint("我中間劇情還沒寫完(尖叫)",2); 
	slowPrint("等全部寫完我再一起放上來好了(陰暗地爬走)",2); 
}

void dialogue(int character){
	cout<<endl;
	slowPrint("你正準備翻到下一頁查看結果，卻冷不防地——「咚！」",3);
	slowPrint("一塊起司從書架上掉下來，直直砸在你頭上。",3); 
	cout<<endl;
	slowPrint("「嘶……」",1); 
	slowPrint("你忍不住倒吸一口氣，摸了摸頭，心想這下明天肯定會腫個包。",3); 
	slowPrint("還沒來得及抱怨，當你再次抬起頭時，一位不知何時出現的陌生人站在你面前。",3); 
	if(character==1) character_Bech();
	else if(character==2) character_Feichanyin();
	else if(character==3) character_Roselyne();
	else if(character==4) character_Iris();
	else if(character==5) character_Taro();
	else if(character==6) character_Siegfried();
	else if(character==7) character_Mina();
	else if(character==8) character_Suoxiaohua();
	else if(character==9) character_Liuyiyi();
}


void ending(){
	cout<<endl;
	slowPrint("你思考著接下來要說甚麼，此時一個念頭劃過腦海。",3);
	cout<<endl;
	slowPrint("「完了！！！我明天要交的報告 還！ 沒！ 做！！！」",1);
	cout<<endl;
	slowPrint("你不管三七二十一急忙衝去抓起起司。",3);
	slowPrint("途中你下意識地回過頭，與面前這位剛認識的陌生人對上眼。",3);
	cout<<endl;
	slowPrint("你眨了眨眼，算是無聲的道別，因為下一刻你的意識便被突如其來的眩暈帶走。",3);
	cout<<endl;
	slowPrint("…",3);
	slowPrint("……",3);
	slowPrint("………",3);
	cout<<endl;
	slowPrint("當你再度醒來時，面前的景色變回你熟悉的圖書館，也沒看到奇怪的人影。",3);
	slowPrint("你愣了一下，而後笑起來，決定把這段特別的經歷放在心裡，繼續未來的生活。",3);
	cout<<endl;
	slowPrint("〔The End〕",3);
}

int main() {
	HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);
    DWORD dwMode = 0;
    GetConsoleMode(hOut, &dwMode);
    dwMode |= ENABLE_VIRTUAL_TERMINAL_PROCESSING;
    SetConsoleMode(hOut, dwMode);
    
    
    opening();
    library_map();
    dialogue(test_text());
    ending();
    
    
    return 0;
}
//slowPrint("",3); 
//cout<<""<<endl;




